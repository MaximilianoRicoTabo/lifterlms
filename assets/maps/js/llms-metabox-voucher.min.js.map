{"version":3,"file":"../../js/llms-metabox-voucher.min.js","sources":["llms-metabox-voucher.js"],"sourcesContent":["(function( $ ){\n\n\tvar deleteIds = [];\n\n\t$( document ).ready(function () {\n\n\t\tvar changeNotSaved          = false;\n\t\tvar codesAddedSinceLastSave = 0;\n\n\t\t$( '#llms_voucher_add_codes' ).click(function (e) {\n\t\t\te.preventDefault();\n\n\t\t\tvar qty  = $( '#llms_voucher_add_quantity' ).val();\n\t\t\tvar uses = $( '#llms_voucher_add_uses' ).val();\n\t\t\tvar html = '';\n\n\t\t\tchangeNotSaved = true;\n\n\t\t\tif ($.isNumeric( qty ) && $.isNumeric( uses )) {\n\t\t\t\tif (parseInt( qty ) > 0 && parseInt( uses ) > 0) {\n\n\t\t\t\t\tif (qty > 50) {\n\t\t\t\t\t\talert( \"You can only generate 50 rows at a time\" );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tcodesAddedSinceLastSave += parseInt( qty );\n\n\t\t\t\t\tif (codesAddedSinceLastSave > 50) {\n\t\t\t\t\t\talert( \"Please save before adding any more codes, limit is 50 at a time\" );\n\t\t\t\t\t\tcodesAddedSinceLastSave -= parseInt( qty );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (var i = 1; i <= parseInt( qty ); i++) {\n\t\t\t\t\t\thtml += '<tr>' +\n\t\t\t\t\t\t\t'<td></td>' +\n\t\t\t\t\t\t\t'<td>' +\n\t\t\t\t\t\t\t'<input type=\"text\" maxlength=\"20\" placeholder=\"Code\" value=\"' + randomizeCode() + '\" name=\"llms_voucher_code[]\">' +\n\t\t\t\t\t\t\t'<input type=\"hidden\" name=\"llms_voucher_code_id[]\" value=\"0\">' +\n\t\t\t\t\t\t\t'</td>' +\n\t\t\t\t\t\t\t'<td><span>0 / </span><input type=\"text\" placeholder=\"Uses\" value=\"' + uses + '\" class=\"llms-voucher-uses\" name=\"llms_voucher_uses[]\"></td>' +\n\t\t\t\t\t\t\t'<td><a href=\"#\" class=\"llms-voucher-delete\">' + delete_icon + '</a></td>' +\n\t\t\t\t\t\t\t'</tr>';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t$( '#llms_voucher_tbody' ).append( html );\n\n\t\t\tbindDeleteVoucherCode();\n\t\t});\n\n\t\tbindDeleteVoucherCode();\n\n\t\t$( '#llms_voucher_tbody input' ).change(function() {\n\t\t\tchangeNotSaved = true;\n\t\t});\n\n\t\t$( \"#post\" ).on( 'submit', function() {\n\t\t\tif ($( '#publish' ).attr( 'name' ) === 'publish') {\n\t\t\t\t$( '<input />' ).attr( 'type', 'hidden' )\n\t\t\t\t\t.attr( 'name', \"publish\" )\n\t\t\t\t\t.attr( 'value', \"true\" )\n\t\t\t\t\t.appendTo( '#post' );\n\t\t\t}\n\t\t\treturn true;\n\t\t} );\n\n\t\twindow.onbeforeunload = function() {\n\t\t\treturn changeNotSaved ? \"If you leave this page you will lose your unsaved changes.\" : null;\n\t\t};\n\n\t\t$( 'input[type=submit][name=save]' ).click(function (e) {\n\t\t\tvar unique_values = {};\n\t\t\tvar duplicate     = false;\n\t\t\t$( 'input[name=\"llms_voucher_code[]\"]' ).each(function() {\n\t\t\t\tvar val = $( this ).val()\n\t\t\t\tif ( ! unique_values[val] ) {\n\t\t\t\t\tunique_values[val] = true;\n\t\t\t\t} else {\n\t\t\t\t\t$( this ).css( 'background-color', 'rgba(226, 96, 73, 0.6)' );\n\t\t\t\t\tduplicate = true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (duplicate) {\n\t\t\t\talert( 'Please make sure that there are no duplicate voucher codes.' );\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// If course or membership is not selected, don't allow user to save.\n\t\t\tif ( ! $( '#_llms_voucher_courses' ).val().length && ! $( '#_llms_voucher_membership' ).val().length ) {\n\t\t\t\talert( 'Please select course or membership before saving.' );\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tchangeNotSaved = false;\n\t\t\tcheck_voucher_duplicate();\n\t\t\treturn false;\n\t\t});\n\n\t\tfunction bindDeleteVoucherCode() {\n\t\t\t$( '.llms-voucher-delete' ).unbind( 'click' );\n\t\t\t$( '.llms-voucher-delete' ).click(function (e) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tvar t   = $( this );\n\t\t\t\tvar old = t.data( 'id' );\n\n\t\t\t\tchangeNotSaved = true;\n\n\t\t\t\tif (old) {\n\t\t\t\t\tdeleteIds.push( old );\n\n\t\t\t\t\t$( '#delete_ids' ).val( deleteIds.join( ',' ) );\n\t\t\t\t} else {\n\t\t\t\t\tcodesAddedSinceLastSave--;\n\t\t\t\t}\n\n\t\t\t\t// remove html block\n\t\t\t\tt.closest( 'tr' ).remove();\n\t\t\t});\n\t\t}\n\t});\n\tfunction randomizeCode() {\n\t\tvar text     = '';\n\t\tvar possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\n\t\tfor (var i = 0; i < 12; i++) {\n\t\t\ttext += possible.charAt( Math.floor( Math.random() * possible.length ) );\n\t\t}\n\n\t\treturn text;\n\t}\n\n\t/**\n\t * Check for voucher duplicates in other posts.\n\t *\n\t * @since Unknown\n\t * @since 5.9.0 Add nonce.\n\t *\n\t * @return {void}\n\t */\n\tfunction check_voucher_duplicate() {\n\n\t\tvar data = {\n\t\t\taction: 'check_voucher_duplicate', 'postId' :\n\t\t\tjQuery( '#post_ID' ).val(),\n\t\t\t'codes' :  get_codes_from_inputs(),\n\t\t\t_ajax_nonce: window.llms.ajax_nonce,\n\t\t};\n\n\t\tvar ajax = new Ajax( 'post', data, false );\n\t\tajax.check_voucher_duplicate();\n\t}\n\n\tfunction get_codes_from_inputs() {\n\t\tvar codes = [];\n\t\t$( 'input[name=\"llms_voucher_code[]\"]' ).each(function() {\n\t\t\tcodes.push( $( this ).val() );\n\t\t});\n\n\t\treturn codes;\n\t}\n\n})( jQuery );\n\nfunction llms_on_voucher_duplicate (results) {\n\tif (results.length) {\n\t\tfor (var i = 0; i < results.length; i++ ) {\n\t\t\tjQuery( 'input[value=\"' + results[i].code + '\"]' ).css( 'background-color', 'rgba(226, 96, 73, 0.6)' );\n\t\t}\n\t\talert( 'Please make sure that there are no duplicate voucher codes.' );\n\t} else {\n\t\tjQuery( \"#post\" ).submit();\n\t}\n}\n"],"names":["llms_on_voucher_duplicate","results","length","i","jQuery","code","css","alert","submit","$","deleteIds","document","ready","changeNotSaved","codesAddedSinceLastSave","bindDeleteVoucherCode","unbind","click","e","preventDefault","t","this","old","data","push","val","join","closest","remove","qty","uses","html","isNumeric","parseInt","text","possible","charAt","Math","floor","random","delete_icon","append","change","on","attr","appendTo","window","onbeforeunload","unique_values","duplicate","each","action","postId","codes","_ajax_nonce","llms","ajax_nonce","Ajax","check_voucher_duplicate"],"mappings":"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","sourceRoot":"../../js"}