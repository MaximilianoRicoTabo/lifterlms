!function(i){window.llms=window.llms||{},window.llms.checkout=new function(){var m=[],s=[];return this.$checkout_form=i("#llms-product-purchase-form"),this.$confirm_form=i("#llms-product-purchase-confirm-form"),this.$form_sections=!1,this.form_action=!1,this.init=function(){var t=this;i(".llms-checkout-wrapper").length&&this.bind_login(),this.$checkout_form.length?(this.form_action="checkout",this.$form_sections=this.$checkout_form.find(".llms-checkout-section"),this.$checkout_form.on("submit",this,this.submit),i(".llms-password-strength-meter").length&&this.add_before_submit_event({data:LLMS.PasswordStrength,handler:LLMS.PasswordStrength.checkout}),this.bind_coupon(),this.bind_gateways()):this.$confirm_form.length&&(this.form_action="confirm",this.$form_sections=this.$confirm_form.find(".llms-checkout-section"),this.$confirm_form.on("submit",function(){t.processing("start")}))},this.add_before_submit_event=function(t){t.handler&&"function"==typeof t.handler&&(t.data||(t.data=null),m.push(t))},this.add_error=function(t,e){var s="llms-checkout-errors";$err=i("#"+s),$err.length||($err=i('<ul class="llms-notice llms-error" id="'+s+'" />'),i(".llms-checkout-wrapper").prepend($err)),$err.append("<li>"+t+"</li>"),e&&console.error(e)},this.add_gateway=function(t){s.push(t)},this.bind_coupon=function(){var e=this;i('a[href="#llms-coupon-toggle"]').on("click",function(t){t.preventDefault(),i(".llms-coupon-entry").slideToggle(400)}),i("#llms-apply-coupon").on("click",function(t){t.preventDefault(),e.coupon_apply(i(this))}),i("#llms-remove-coupon").on("click",function(t){t.preventDefault(),e.coupon_remove(i(this))})},this.bind_gateways=function(){this.load_gateways(),i('input[name="llms_payment_gateway"]').length||i("#llms_create_pending_order").removeAttr("disabled"),i('input[name="llms_payment_gateway"]').on("change",function(){i('input[name="llms_payment_gateway"]').each(function(){var t=i(this),e=t.closest(".llms-payment-gateway"),s=e.find(".llms-gateway-fields").find("input, textarea, select"),o=t.is(":checked");e[o?"addClass":"removeClass"]("is-selected"),o?(s.removeAttr("disabled"),i(".llms-payment-gateways").trigger("llms-gateway-selected",{id:t.val(),$selector:e})):s.attr("disabled","disabled")})}),i(".llms-payment-gateways").on("llms-gateway-selected",function(t,e){var s=i("#llms_create_pending_order");e.$selector&&e.$selector.find(".llms-gateway-fields .invalid").length?s.attr("disabled","disabled"):s.removeAttr("disabled")})},this.bind_login=function(){i('a[href="#llms-show-login"]').on("click",function(t){t.preventDefault(),i(this).closest(".llms-info,.llms-notice").slideUp(400),i("form.llms-login").slideDown(400)})},this.clear_errors=function(){i("#llms-checkout-errors").remove()},this.coupon_apply=function(t){var s=this,e=i("#llms_coupon_code").val(),o=i(".llms-coupon-messages"),n=o.find(".llms-error"),l=i("form.llms-checkout");LLMS.Spinner.start(l),window.LLMS.Ajax.call({data:{action:"validate_coupon_code",code:e,plan_id:i("#llms-plan-id").val()},beforeSend:function(){n.hide()},success:function(t){var e;LLMS.Spinner.stop(l),"error"===t.code?(e=i("<li>"+t.message+"</li>"),n.length?n.empty():(n=i('<ul class="llms-notice llms-error" />'),o.append(n)),e.appendTo(n),n.show()):t.success&&(i(".llms-coupon-wrapper").replaceWith(t.data.coupon_html),s.bind_coupon(),i(".llms-payment-gateways").replaceWith(t.data.gateways_html),s.bind_gateways(),i(".llms-order-summary").replaceWith(t.data.summary_html))}})},this.coupon_remove=function(t){var e=this,s=i("form.llms-checkout");LLMS.Spinner.start(s),window.LLMS.Ajax.call({data:{action:"remove_coupon_code",plan_id:i("#llms-plan-id").val()},success:function(t){LLMS.Spinner.stop(s),t.success&&(i(".llms-coupon-wrapper").replaceWith(t.data.coupon_html),e.bind_coupon(),i(".llms-order-summary").replaceWith(t.data.summary_html),i(".llms-payment-gateways").replaceWith(t.data.gateways_html),e.bind_gateways())}})},this.focus_errors=function(){i("html, body").animate({scrollTop:i("#llms-checkout-errors").offset().top-50},200)},this.load_gateways=function(){for(var t=0;t<=s.length;t++){var e=s[t];"object"==typeof e&&null!==e&&void 0!==e.bind&&"function"==typeof e.bind&&e.bind()}},this.processing=function(t){var e,s;switch(t){case"stop":e="removeClass";break;case"start":default:e="addClass"}"checkout"===this.form_action?s=this.$checkout_form:"confirm"===this.form_action&&(s=this.$confirm_form),s[e]("llms-is-processing"),LLMS.Spinner[t](this.$form_sections)},this.submit=function(t){var o,n=t.data,l=m.length,i=0,r=[],a=0,c=0;t.preventDefault(),n.processing("start"),n.clear_errors();for(var e=0;e<m.length;e++){var s=m[e];s.handler(s.data,function(t){a++,!0===t?c++:"string"==typeof t&&r.push(t)})}o=setInterval(function(){var t=!1,e=!1;if(6e4<=i)e=t=!0;else if(l===a)if(l===c)t=!0,n.$checkout_form.off("submit",n.submit),n.$checkout_form.trigger("submit");else if(r.length){e=t=!0;for(var s=0;s<r.length;s++)n.add_error(r[s]);n.focus_errors()}t&&clearInterval(o),e&&n.processing("stop"),i++},100)},this.init(),this}}(jQuery);
//# sourceMappingURL=../maps/js/llms-form-checkout.min.js.map
