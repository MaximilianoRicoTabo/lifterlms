#!/usr/bin/node

/**
 * Docgen script.
 *
 * After creating a temporary snapshot of the icon library React app, this script
 * parses the static HTML and adds the icon table to the README.md file in the
 * package root.
 */

const cheerio = require( 'cheerio' ),
	{ readFileSync, writeFileSync } = require( 'fs' );

const $ = cheerio.load( readFileSync( 'docs/build/index.html', 'utf8' ) ),
	$table = $( '#app' ).html();

const readmeFile = 'README.md',
	readmeContents = readFileSync( readmeFile, 'utf8' ),
	startToken = '<!-- START TOKEN(Autogenerated Icon Gallery) -->',
	endToken = '<!-- END TOKEN(Autogenerated Icon Gallery) -->',
	docsToken = '<!-- DOCS TOKEN -->';

let newReadme = [],
	addLine = true;

readmeContents.split( '\n' ).forEach( ( line ) => {
	if ( line === startToken ) {
		newReadme.push( line );
		newReadme.push( docsToken );
		addLine = false;
	} else if ( line === endToken ) {
		addLine = true;
	}

	if ( addLine ) {
		newReadme.push( line );
	}
} );

newReadme = newReadme.join( '\n' );

writeFileSync( readmeFile, newReadme.replace( docsToken, `\n${ $table }\n` ) );
